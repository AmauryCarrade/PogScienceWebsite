{% extends "admin_base.html" %}
{% load bulma_tags i18n %}

{% block admin_title %}Streamers
    <span class="tag is-primary is-light is-rounded">{{ streamers|length }}</span>{% endblock %}

{% block admin_title_right %}
    {% if perms.streamers.change_streamer %}
        <div class="level-item">
            <button class="button is-primary is-light js-add-streamers">
                <span class="icon"><span class="fas fa-sync-alt"></span></span>
                <span>Actualiser depuis Twitch</span>
            </button>
        </div>
    {% endif %}
    {% if perms.streamers.add_streamer %}
        <div class="level-item">
            <button class="button is-primary is-light js-add-streamers">
                <span class="icon"><span class="fas fa-plus"></span></span>
                <span>Ajouter des streamers</span>
            </button>
        </div>
    {% endif %}
{% endblock %}

{% block admin_content %}
    <div class="columns is-multiline">
        {% for streamer in streamers %}
            <div class="column is-half">
                <div class="card admin-streamer">
                    <div class="card-content">
                        <div class="media">
                            <div class="media-left">
                                <figure class="image is-64x64">
                                    <img src="{{ streamer.profile_image.url }}" alt="{{ streamer.name }}">
                                </figure>
                            </div>
                            <div class="media-content">
                                <p class="title is-4">
                                    {{ streamer.name }}
                                    {% if streamer.live %}<span class="tag is-danger">LIVE</span>{% endif %}
                                </p>
                                <p class="subtitle is-6"><a href="https://twitch.tv/{{ streamer.twitch_login }}" target="_blank">@{{ streamer.twitch_login }}</a></p>
                            </div>
                        </div>

                        <div class="content">
                            {{ streamer.description }}
                        </div>
                    </div>
                    <footer class="card-footer">
                        <a href="#" class="card-footer-item">{% trans "Voir" %}</a>
                        <a href="#" class="card-footer-item">{% trans "Modifier" %}</a>
                        <a href="#" class="card-footer-item">{% trans "Supprimer" %}</a>
                    </footer>
                </div>
            </div>
        {% empty %}
            <div class="column is-half is-offset-one-quarter has-text-centered mt-5">
                <p class="title is-4 block">Il n'y a personne d'enregistré…</p>
                {% if perms.streamers.add_streamer %}
                    <p class="block">
                        Cliquez ci-dessous pour ajouter tout le monde ! Vous pourrez
                        ajouter plusieurs personnes d'un coup, et nous récupèrerons
                        automatiquement les données de base depuis Twitch.
                    </p>
                    <button class="button is-primary js-add-streamers block">
                        <span class="icon"><span class="fas fa-plus"></span></span>
                        <span>Ajouter des streamers <span class="is-hidden-mobile">à PogScience</span></span>
                    </button>
                {% else %}
                    <p class="block">{% trans "Un⋅e administrateur⋅trice peut ajouter du monde dans PogScience." %}</p>
                {% endif %}
            </div>
        {% endfor %}
    </div>

    {% if perms.streamers.add_streamer %}
        <div class="modal" id="js-add-streamers-modale">
            <div class="modal-background"></div>
            <div class="modal-card">
                <form action="" method="POST" id="js-add-streamers-form">
                    <header class="modal-card-head">
                        <p class="modal-card-title">{% trans "Ajouter des streamers à PogScience" %}</p>
                    </header>
                    <section class="modal-card-body">
                        <p class="block">
                            {% blocktrans %}
                                Ajoutez des streamers en entrant un pseudo Twitch par ligne dans le
                                champ ci-dessous. Nous récupèrerons les informations de base sur chacun⋅e
                                automatiquement.
                            {% endblocktrans %}
                        </p>
                        {% csrf_token %}
                        {{ add_streamers_form|bulma_inline }}
                    </section>
                    <footer class="modal-card-foot">
                        <button class="button is-primary" type="submit">{% trans "Ajouter les streamers" %}</button>
                        <button class="button is-text modal-close-handler">{% trans "Annuler" %}</button>
                    </footer>
                </form>
            </div>
            <button class="modal-close is-large" aria-label="{% trans "Fermer" %}"></button>
        </div>
    {% endif %}
{% endblock %}
